# Just a list of random notes for myself

## Tracing

### qtrace

It looks like when I just call `plot_all_histograms/1` I am getting errors. The work around for this is to run the following:

```
session = Qtrace.start_session(:all)
Qtrace.trace_function(session, Skitter.CrawlerWorker, :crawl, 1)

Skitter.set_seed("http://books.toscrape.com/")

hist = Qtrace.get_histogram(session, Skitter.CrawlerWorker, :crawl, 1)
Qtrace.Plotter.plot_histogram(hist)
```

Before finch, and using HTTPoison

```
iex(6)> Qtrace.Plotter.plot_histogram(hist)

Latency Histogram: Skitter.CrawlerWorker.crawl/1
================================================================================
             0              71             143            214            285
     216.6ms │ (1)
     298.3ms │ (1)
     410.9ms │ (2)
     445.1ms │████████████████████████████████████████████████████████████ (285)
     482.2ms │████████████████████████████████████████████ (208)
     522.4ms │████████████████████████████████████ (173)
     566.0ms │████████████████████████████████████ (172)
     613.1ms │████████████████ (78)
     664.2ms │████████████████████████████ (133)
     719.6ms │████████████ (55)
     779.5ms │████████ (36)
     844.5ms │███ (12)
     914.9ms │███ (14)
     991.1ms │██ (9)
       1.07s │██ (9)
       1.16s │█ (4)
       1.26s │ (1)
       1.48s │ (1)
       3.04s │ (1)
             └────────────────────────────────────────────────────────────
             0              71             143            214            285
Stats:
  Min: 216.6ms
  Max: 3.04s
  Samples: 1195
  P50: 522.4ms
  P95: 779.5ms
  P99: 1.07s

:ok
```

After finch:

```
iex(7)> Qtrace.Plotter.plot_histogram(hist)

Latency Histogram: Skitter.CrawlerWorker.crawl/1
================================================================================
             0              56             111            167            222
     216.6ms │█████████████████████████ (94)
     234.6ms │████████████████████ (75)
     254.2ms │█████████████ (49)
     275.4ms │██████ (24)
     298.3ms │██████████ (36)
     323.2ms │████████ (28)
     350.1ms │██ (9)
     379.3ms │████ (13)
     410.9ms │██ (8)
     445.1ms │████████████████████████████████████████████████████████████ (222)
     482.2ms │█████████████████████████████ (106)
     522.4ms │███████████████████████████████████ (128)
     566.0ms │█████████████████████████████████ (122)
     613.1ms │████████████████████ (75)
     664.2ms │█████████████████████ (78)
     719.6ms │████████████ (45)
     779.5ms │██████ (23)
     844.5ms │████████ (28)
     914.9ms │████ (16)
     991.1ms │█████ (20)
       1.07s │█ (5)
       1.26s │██ (9)
       1.37s │█ (2)
       1.74s │ (1)
             └────────────────────────────────────────────────────────────
             0              56             111            167            222
Stats:
  Min: 216.6ms
  Max: 1.74s
  Samples: 1216
  P50: 482.2ms
  P95: 844.5ms
  P99: 1.07s

:ok
```

With http2

```
iex(6)> Qtrace.Plotter.plot_histogram(hist)

Latency Histogram: Skitter.CrawlerWorker.crawl/1
================================================================================
             0              92             183            275            366
     216.6ms │███████████████████████████ (167)
     234.6ms │███ (17)
     254.2ms │████ (27)
     275.4ms │████ (24)
     298.3ms │████ (27)
     323.2ms │███ (20)
     350.1ms │██ (12)
     379.3ms │█ (4)
     410.9ms │██████ (39)
     445.1ms │████████████████████████████████████████████████████████████ (366)
     482.2ms │███████████████████ (115)
     522.4ms │████████████████ (98)
     566.0ms │████████████ (73)
     613.1ms │██████ (38)
     664.2ms │█████████████ (77)
     719.6ms │█████ (28)
     779.5ms │████ (24)
     844.5ms │██ (13)
     914.9ms │██ (14)
     991.1ms │███ (16)
       1.07s │ (3)
       1.16s │██ (11)
       1.26s │█ (6)
       1.37s │ (1)
       1.48s │ (1)
       1.88s │ (1)
             └────────────────────────────────────────────────────────────
             0              92             183            275            366
Stats:
  Min: 216.6ms
  Max: 1.88s
  Samples: 1222
  P50: 445.1ms
  P95: 844.5ms
  P99: 1.16s

:ok

```
